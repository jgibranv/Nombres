<!DOCTYPE>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nombres Pa' Mijo</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  </head>
<body>

<br>
<div class="container-fluid">
	<div class="card">
		<div class="card-heading" style="background-color: #74cc39;">
			Vázquez Bailón
		</div>
		<div class="card-body">
			<div id="nombres"></div>
		</div>
	</div>
</div>
<br>

<div class="container-fluid">
	<div class="card">
		<div class="card-body">
			<div class="row">
				<div class="col">
				</div>
				<div class="col">
					<input type="text" id="buscador" onkeyup="filtra()" placeholder="Search for names..">
					<div class="btn-group" role="group">
					    <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
					    	Filtrar
					    </button>
					    <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
					    	<li><a class="dropdown-item" href="#" id="filtraTodo">Todo</a></li>
					    	<li><a class="dropdown-item" href="#" id="filtraActivos">Activos</a></li>
					    	<li><a class="dropdown-item" href="#" id="filtraRechazados">Rechazados</a></li>
					    </ul>
					</div>
				</div>
				<div class="col"></div>
			</div>
		</div>
	</div>
	<div class="card">
		<div class="card card-heading" style="background-color: #34ebc3">
			Combinaciones
		</div>
		<div class="card-body">
			<table class="table table-striped table-hover table-bordered" id="combinaciones">
				<thead>
					<th style="width: 10%">#</th>
					<th>Primer Nombre</th>
					<th>Segundo Nombre</th>
					<th style="width: 30%">Boton</th>
				</thead>
				<tbody></tbody>
			</table>
		</div>
	</div>
</div>

<script type="text/javascript">
const arrNombres = ["Dante", "Magnus", "Kurt", "Franz", "Marco", "Dominik", "Drago", "Jurgen", "Leo", "Bastian", "Ezzio", 
	"Drakken", "Bjorn", "Anton", "Giovanni", "Luka", "Ander", "Nico", "Nicolas", "Tiago", "Bruno"];
arrNombres.sort();
var filtroEstado = "todo";

class CombiUni {
	constructor(nombre) {
		this.nombre = nombre;
		this.activo = true;
	}
	mostrar() {
		return this.nombre + " Vázquez Bailón";
	}
}

class CombiDuo {
	constructor(pNombre, sNombre) {
		this.pNombre = pNombre;
		this.sNombre = sNombre;
		this.primerOrdenActivo = true;
		this.segundoOrdenActivo = true;
	}
	mostrar() {
		console.log(this.pNombre + " " + this.sNombre + " Vázquez Bailón");
	}
	mostrar_inversion() {
		console.log(this.sNombre + " " + this.pNombre + " Vázquez Bailón");
	}
	rechazar_primer_orden() {
		console.log("Rechazado");
	}
}

const arrCombi = [];

// Agrega los primeros nombres unicos al arreglo de objetos arrCombi
arrNombres.forEach(function(nombre, indice){
	arrCombi[indice] = new CombiUni(nombre);
});

// Agrega las combinaciones al arreglo arrCombi
// El total de objetos agregados es igual al total de nombres * total de nombres menos uno entre dos. n*(n-1)/2
// Esto con el fin de evitar incluir combinaciones repetidas (en las combinaciones no importa el orden de los elementos)
for (var i=0; i<arrNombres.length; i++) {
	for (var j=0; j<arrNombres.length; j++) {
		if ( j > i ) { // Esta expresion evita que se repitan los elementos
			arrCombi.push(new CombiDuo(arrNombres[i], arrNombres[j]));
		}
	}
}

// console.log(arrCombi);
// console.log(arrCombi[230].pNombre);

// Muestra los nombres en el card
stringNombres = arrNombres.join(', ');
document.getElementById("nombres").innerHTML = stringNombres;

var tabla = document.getElementById("combinaciones");

// Pone los nombres en la tabla
arrCombi.forEach(function(objeto, indice){
	var row = tabla.insertRow(-1);
	row.id = "tr"+indice;
	var celda1 = row.insertCell(0);
	var celda2 = row.insertCell(1);
	var celda3 = row.insertCell(2);
	var celda4 = row.insertCell(3);

	if (objeto instanceof CombiUni){
		celda1.innerHTML = indice+1;
		celda2.innerHTML = objeto.nombre;
	}
	if (objeto instanceof CombiDuo){
		celda1.innerHTML = indice+1+ " <button type='button' id='cambiaOrden"+indice+"' class='cambio btn btn-light bi bi-arrow-left-right'></button> ";
		celda2.innerHTML = objeto.pNombre;
		celda3.innerHTML = objeto.sNombre;
	}

	carga_botones(objeto, indice);
});

// Escucha los clicks a los botones de la tabla y ejecuta la funcion correspondiente al boton
tabla.addEventListener('click', (event) => {
	const isButton = event.target.nodeName === 'BUTTON';
	if (!isButton) {
	return;
	}
	// Cambia el orden de las combinaciones de dos nombres
	if (event.target.classList.contains("cambio")) {
		cambia_orden(event.target.id);
	}
	// Cambia el estatus de las combinaciones de un nombre
	if (event.target.classList.contains("cambiaEstatusUOrden")) {
		cambia_estatus_unico_orden(event.target.id);
	}
	// Cambia el estatus del primer orden de las combinaciones de dos nombres
	if (event.target.classList.contains("cambiaEstatusPOrden")) {
		cambia_estatus_primer_orden(event.target.id);
	}
	// Cambia el estatus del segundo orden de las combinaciones de dos nombres
	if (event.target.classList.contains("cambiaEstatusSOrden")) {
		cambia_estatus_segundo_orden(event.target.id);
	}
})
// Cambia el orden de las combinaciones de dos nombres
function cambia_orden(id) {
	var id = id.slice(11);
	var celda1 = document.getElementById('tr'+id).cells[1].innerHTML;
	var celda2 = document.getElementById('tr'+id).cells[2].innerHTML;
	var celdaTemp = "";
	celdaTemp = document.getElementById('tr'+id).cells[1].innerHTML;
	document.getElementById('tr'+id).cells[1].innerHTML = document.getElementById('tr'+id).cells[2].innerHTML;
	document.getElementById('tr'+id).cells[2].innerHTML = celdaTemp;
}

// Cambia el estatus de las combinaciones de un nombre
function cambia_estatus_unico_orden(id) {
	var id = id.slice(16);
	arrCombi[id].activo ? arrCombi[id].activo=false : arrCombi[id].activo=true
	carga_botones(arrCombi[id], id);

	if ( arrCombi[id].activo == false ) {
		document.getElementById("tr"+id).classList.add('table-danger');
	} else {
		if ( document.getElementById("tr"+id).classList.contains("table-danger") ) {
			document.getElementById("tr"+id).classList.remove("table-danger");
		}
	}
}
// Cambia el estatus del primer orden de las combinaciones de dos nombres
function cambia_estatus_primer_orden(id) {
	var id = id.slice(16);
	arrCombi[id].primerOrdenActivo ? arrCombi[id].primerOrdenActivo=false : arrCombi[id].primerOrdenActivo=true
	carga_botones(arrCombi[id], id);

	if (arrCombi[id].primerOrdenActivo == false && arrCombi[id].segundoOrdenActivo == false ) {
		document.getElementById("tr"+id).classList.add("table-danger");
	} else {
		if (document.getElementById("tr"+id).classList.contains("table-danger")) {
			document.getElementById("tr"+id).classList.remove("table-danger");
		}
	}
}
// Cambia el estatus del segundo orden de las combinaciones de dos nombres
function cambia_estatus_segundo_orden(id) {
	var id = id.slice(16);
	arrCombi[id].segundoOrdenActivo ? arrCombi[id].segundoOrdenActivo=false : arrCombi[id].segundoOrdenActivo=true
	carga_botones(arrCombi[id], id);
	console.log(document.getElementById("tr"+id));

	if (arrCombi[id].primerOrdenActivo == false && arrCombi[id].segundoOrdenActivo == false ) {
		document.getElementById("tr"+id).classList.add("table-danger");
	} else {
		if (document.getElementById("tr"+id).classList.contains("table-danger")) {
			document.getElementById("tr"+id).classList.remove("table-danger");
		}
	}
}

function carga_botones(objeto, id) {
	if (objeto instanceof CombiUni){
		if(objeto.activo) {
			document.getElementById('tr'+id).cells[3].innerHTML = "<button type='button' id='btnCambiaEstatus"+id+"' class='cambiaEstatusUOrden btn btn-outline-danger btn-sm'>Rechazar</button>";
		} else {
			document.getElementById('tr'+id).cells[3].innerHTML = "<button type='button' id='btnCambiaEstatus"+id+"' class='cambiaEstatusUOrden btn btn-outline-success btn-sm'>Activar</button>";
		}
	}

	if (objeto instanceof CombiDuo){
		var contCelda4 = "";
		if(objeto.primerOrdenActivo) {
			contCelda4 += " <button type='button' id='btnCambiaEstatus"+id+"' class='cambiaEstatusPOrden btn btn-outline-danger btn-sm'>Rechazar Primer Orden</button>";
		} else {
			contCelda4 += " <button type='button' id='btnCambiaEstatus"+id+"' class='cambiaEstatusPOrden btn btn-outline-success btn-sm'>Activar Primer Orden</button>";
		}
		if(objeto.segundoOrdenActivo) {
			contCelda4 += " <button type='button' id='btnCambiaEstatus"+id+"' class='cambiaEstatusSOrden btn btn-outline-danger btn-sm'>Rechazar Segundo Orden</button>";
		} else {
			contCelda4 += " <button type='button' id='btnCambiaEstatus"+id+"' class='cambiaEstatusSOrden btn btn-outline-success btn-sm'>Activar Segundo Orden</button>";
		}
		document.getElementById('tr'+id).cells[3].innerHTML = contCelda4;
	}
}

function filtra() {
	// Declare variables
	var input, filtro, table, tr, td1, td2, i, txtValue1, txtValue2;
	input = document.getElementById("buscador");
	filtro = input.value.toUpperCase();
	table = document.getElementById("combinaciones");
	tr = table.getElementsByTagName("tr");

	// Loop through all table rows, and hide those who don't match the search query
	for (i = 0; i < tr.length; i++) {
		td1 = tr[i].getElementsByTagName("td")[1];
		td2 = tr[i].getElementsByTagName("td")[2];
		if (td1) {
			txtValue1 = td1.textContent || td1.innerText;
			txtValue2 = td2.textContent || td2.innerText;
			if (txtValue1.toUpperCase().indexOf(filtro) > -1 || txtValue2.toUpperCase().indexOf(filtro) > -1) {
				switch (filtroEstado) {
				case "Todo":1
					tr[i].style.display = "";
					break;
				case "Activos":
					if( arrCombi[i-1] instanceof CombiUni && arrCombi[i-1].activo == true) {
						tr[i].style.display = "";
					} else if( arrCombi[i-1] instanceof CombiDuo && ( arrCombi[i-1].primerOrdenActivo == true || arrCombi[i-1].segundoOrdenActivo == true )) {
						tr[i].style.display = "";
					} else {
						tr[i].style.display = "none";
					}
					break;
				case "Rechazados":
					if( arrCombi[i-1] instanceof CombiUni && arrCombi[i-1].activo == false) {
						tr[i].style.display = "";
					} else if( arrCombi[i-1] instanceof CombiDuo && ( arrCombi[i-1].primerOrdenActivo == false && arrCombi[i-1].segundoOrdenActivo == false )) {
						tr[i].style.display = "";
					} else {
						tr[i].style.display = "none";
					}
					break;
				}
			} else {
				tr[i].style.display = "none";
			}
		}
	}
}

document.getElementById("filtraTodo").addEventListener('click', function() {
	filtroEstado = "Todo";
	filtra();
})
document.getElementById("filtraActivos").addEventListener('click', function() {
	filtroEstado = "Activos";
	filtra();
})
document.getElementById("filtraRechazados").addEventListener('click', function() {
	filtroEstado = "Rechazados";
	filtra();
})

</script>

<!-- JS bundle de Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

</body>
</html>
